---
layout:     post 
title:      "Concolutional Neural Networks (CNNs)"
subtitle:   "Some concepts and codings about CNNs"
date:       2023-10-11T18:22:08+08:00
author:     "Ka Ian"
draft:      true
image:      "img/coding_bg.jpg"
tags:
  - "deep learning"
  - "keras"
  - "coding"
  - "python"
---

## Architecture

* Convolution Layer: Can separates and identifies the various features of images (= feature extraction)

* Pooling Layer: Summarise the features presents in a region of the feature map generated by a convoution layer (= reduce dimensions)

* Fully-Connected Layer: Use the output from the convolution process, and predicts the class of the image based on the features extracted in previous stages. It can only handle one-dimensions layer.

## Other information

* Input shape should represent data reshaped as an image

* Stack many convolution and pooling layers are optimal

* Select strides and padding hyperparameters carefully

* Should use a **_flatten layer_** before the final full-connected layer

* Activation function based on the type of task

* With tabular data, need to reshape input rows to metrics

## Coding - CNNs

### 1. Load Libraries

```
import numpy as np
import pandas as pd
from numpy import loadtxt
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import BatchNormalization, Conv2D, Flatten, Dense
```

### 2. Load the dataset

```
df = loadtxt('dataset.csv', delimiter=',')
```

### 3. Split the dataset into the featuers and label

```
X = df[:, 0:8] # feature vectors
y = df[:, 8] # target vector
```

### 4. Reshape the Data to Simulate an image (grayscale or RGB)

```
tmp = np.array(X)
tmp = tmp.reshape(-1, 2, 4)
X = pd.DataFrame(sum(map(list, tmp), []))
tmp = []

for i, g in X.groupby(np.arange(len(X))//2):
  tmp.append(g)

tmp = np.array([i.to_numpy() for i in tmp])

# this is a 4-dims metrics
# 768 total instances (768 images), height of each img is 2px, weight of each img is 4px, 1 channel (as grayscale)
x = tmp.reshape(768, 2, 4, 1)
```

### 5. Define the Neural Network Architecture (Define keras model)

```
model = Sequential() # sequential model
model.add(Conv2D(1, activation='relu', kernel_size=2, input_shape=(2, 4, 1))) # kernel_size is 2x2, 
model.add(BatchNormalization()) # normalise values
model.add(Flatten())
model.add(BatchNormalization())
model.add(Dense(1, input_shape=(2, 4, 1), activation='sigmoid'))
```

### 6. Compile the Model

```
model.compile(
    loss = 'binary_crossentropy',
    optimizer = 'adam',
    metrics=['accuracy'],
)
```

### 7. Fit the Model

```
model.fit(x, y, epochs=20, batch_size=8)
```

### 8. Evaluate the Model (accuracy)

```
_, accuracy = model.evaluate(x, y)
print('accuracy: %.2f' % (accuracy * 100))
```